---
title: Introduccio a Docker
layout: default
parent: Sistemes de Gesti√≥ Empresarial
nav_order: 5
has_children: true
has_toc: true
---

# **1. Guia d‚Äôestudi**
## Coneixements previs requerits
- √ös b√†sic de sistemes operatius.
- Coneixement de comandaments de Linux.
- Utilitzaci√≥ de comandaments de Docker i Docker Compose.
- Coneixements per a desplegar Odoo.
      
## Objectius
- Aprendre a implantar Odoo i a instal¬∑lar i configurar m√≤duls d‚ÄôOdoo mitjan√ßant un cas pr√†ctic.
      
## Continguts
Aquesta unitat t√© associada una activitat avaluable.
      
## Activitats
√âs molt important llegir els apunts i dur a terme les tasques no avaluables, a m√©s de les avaluables.
      
## Bibliografia
Aquest document est√† basat en els apunts d‚Äôaquesta assignatura impartida pels professors:
- Garc√≠a Barea, Sergi.
    
## **2. Introducci√≥**
En aquesta unitat mostrarem com implantar un sistema Odoo 17 en una empresa. Per a aix√≤ ens valdrem d'un exemple d'implantaci√≥ d'un sistema ERP en una taverna. Partirem del context en qu√® tenim un sistema Odoo amb la instal¬∑laci√≥ b√†sica proposada en la unitat 2.

>‚ùï Atenci√≥:  aquesta unitat no √©s un exemple "pas a pas" de com realitzar totes les accions, sin√≥ un esb√≥s de quina configuraci√≥ i m√≤duls poden utilitzar-se per implantar Odoo 17 Per a alguns detalls haureu de recolzar-vos en la documentaci√≥ d'usuari.

**<u>Documentaci√≥ d'usuari d‚ÄôOdoo 17</u>**:  [https://www.odoo.com/documentation/17.0/]

## 2.1  Context cas pr√†ctic: La taverna de Moe
Moe Szyslak √©s un conegut taverner que regenta "La taverna de Moe". Habitualment els seus parroquians parlen d'incoher√®ncies, canten can√ßons, discuteixen sobre assumptes diversos, etc.

Tots paguen les seues consumicions religiosament, l'√∫nic dels seus parroquians a qu√® li fia √©s a Barney Gumble, qui √©s el seu millor client. Tot i aix√≤, Barney t√© tantes coses apuntades a comptes que una simple llibreta no √©s suficient per a portar b√© el compte de Barney (de fet, en una ocasi√≥ Moe va portar el compte de Barney a la NASA per poder calcular quan li hi havia).

Aquest problema el va fer reflexionar a Moe i l'ha impulsat a plantejar modernitzar el seu negoci. Despr√©s de plantejar diverses opcions, Moe (que √©s conegut per la seua gasiveria) ha decidit utilitzar Odoo 17 Community Edition, especialment per ser lliure i gratu√Øt.

# **3. M√≤dul ‚ÄúFacturaci√≥‚Äù**
Els primers elements que Moe vol controlar en el seu negoci √©s la facturaci√≥. Per a aix√≤, haurem de buscar "facturaci√≥" i instal¬∑lar aquest m√≤dul, com es veu en aquesta imatge:

![alt text](./imatges/image.png)

Despr√©s de seguir els passos d'instal¬∑laci√≥ i tenir una mica de paci√®ncia (els m√≤duls poden trigar a instal¬∑lar-se), tindrem el m√≤dul instal¬∑lat al nostre sistema. 

Una vegada instal¬∑lat, si tornem a "Aplicacions" (men√∫ "superior esquerra"), i en "Filtres" vam indicar "m√≤duls instal¬∑lats", podrem observar que m√≤duls tenim instal¬∑lats.

En aquest cas, a m√©s de facturaci√≥, ens ha instal¬∑lat un altre m√≤dul addicional, "Converses", que necessita al m√≤dul "Facturaci√≥" per a funcionar. Aquesta acci√≥ passa habitualment, ja que hi ha molts m√≤duls amb interdepend√®ncies.

Aqu√≠ un exemple de m√≤duls instal¬∑lats despr√©s d'instal¬∑lar "Facturaci√≥".

![alt text](./imatges/image-1.png)

## 3.1  Passos previs a usar el m√≤dul ‚ÄúFacturaci√≥‚Äù
Abans d'usar el m√≤dul de "Facturaci√≥", val la pena fer / comprovar alguns xicotets ajustos. Per a aix√≤ "Configuraci√≥" al men√∫ "superior esquerra" i configurem algunes opcions. 

**Dades de l'empresa: (A "Configuraci√≥ -> Opcions generals")**
![alt text](./imatges/image-2.png)

Aqu√≠ podreu indicar informaci√≥ de l'empresa. Entre ells destaca triar el nom de l'empresa o col¬∑locar un logotip com observem en la seg√ºent imatge.

![alt text](./imatges/image-3.png)

>‚ùï Atenci√≥: √©s important recordar que quan feu servir Odoo, encara que en algunes parts hi ha guardat autom√†tic, √©s una bona pr√†ctica assegurar-nos de guardar fent clic en la icona de guardar (o en algunes pantalles, en un bot√≥ amb el text ‚ÄúGuardar‚Äù). Aix√≠ evitem el risc de perdre dades.

**Localitzaci√≥ fiscal: (A "Configuraci√≥ -> Facturaci√≥ / Comptabilitat")**:
Aqu√≠ podrem comprovar entre altres coses que la "Localitzaci√≥ fiscal" i "Impostos per defecte" amb els quals treballar√† Odoo s√≥n correctes. Per al nostre cas utilitzarem PIMES 2008 i 21% IVA.

![alt text](./imatges/image-4.png)

## 3.2  Esbossos d'√∫s de la lli√ß√≥ facturaci√≥
Per treballar amb el m√≤dul facturaci√≥ anirem a men√∫ "superior esquerre" i seleccionarem "Facturaci√≥ / Comptabilitat". Despr√©s d'aix√≤, en la part superior esquerra veurem el text "Facturaci√≥ / Comptabilitat" i a la seua dreta immediata algunes seccions d'aquest m√≤dul: "Clients" (operacions relacionades amb clients), "Prove√Ødors" (Operacions relacionades amb prove√Ødors), "Informes" (generaci√≥ d'informes) i "Configuraci√≥" (per configurar aspectes de la lli√ß√≥). A baix d'aquestes, veurem un bot√≥ per crear factures.

<div align="center">
  <img src="./imatges/image-5.png" alt="Texto alternativo">
</div>

En general, les operacions que hauria de realitzar Moe per operar en aquest m√≤dul serien:
- Donar d'alta tant a clients com a prove√Ødors.
  - Si una persona o entitat √©s alhora client i prove√Ødor, deu donar-se d'alta en les dues seccions.
  - Per al cas d'empreses molt conegudes, Odoo t√© una base de dades que permet autocompletar dades d'aquestes empreses com a client o prove√Ødor.
- Un cop donades d'alta les entitats, es poden tant emetre factures (a clients) o emmagatzemar factures emeses per part d'un prove√Ødor.
  - A m√©s de registrar les factures, en el moment del pagament, haurem d‚Äôindicar-ho.

Aqu√≠ un exemple d'una factura emesa a "Barney Gumble", pendent de pagament.

![alt text](./imatges/image-6.png)

Ac√≠ un exemple de factura pagada a un prove√Ødor:

![alt text](./imatges/image-7.png)


# **4. M√≤dul "Empleats"**
Ara que Moe ja t√© Odoo amb el m√≤dul de "Facturaci√≥", els comptes de Barney Gumble ja no s√≥n un problema per a ell. El temps lliure que ha guanyat gr√†cies a aquests canvis, els ha invertit a netejar i endre√ßar una mica la taverna. Sorprenentment, aix√≤ ha fet que acudisca m√©s gent a m√©s dels seus parroquians habituals, per la qual cosa s'ha plantejat contractar gent perqu√® l'ajude amb el seu negoci.

Per poder gestionar aquests nous empleats, instal¬∑larem el m√≤dul "Empleats".

![alt text](./imatges/image-8.png)

Un cop instal¬∑lat tot correctament, tindrem al men√∫ "superior esquerre" una nova secci√≥ "Empleats", amb subseccions com "Empleats", "Directori d'empleats", "Departaments" i "Configuraci√≥".

![alt text](./imatges/image-9.png)

Entre altres opcions, amb aquest m√≤dul podrem:
- Donar d'alta/baixa a empleats.
- Crear departaments i assignar empleats a aquests mateixos.

A la seg√ºent imatge, podem veure un exemple on s'han configurat els departaments "Vendes" i "Administraci√≥" en el sistema.

![alt text](./imatges/image-10.png)

Aqu√≠ un exemple on s'ha donat d'alta a "Lurleen Lumpkin" al departament de "Vendes", i a "Waylon Smithers" al departament d'"Administraci√≥".

![alt text](./imatges/image-11.png)

> üìñ Important:  en crear/editar l'empleat, si escau, podem crear-li i assignar un compte Odoo perqu√® puga accedir al sistema.
       
# **5. M√≤dul "Compra"**
Contractar Smithers com a comptable ha estat un encert. Per√≤ aquest li ha suggerit a Moe que ha d'implementar un m√≤dul per a gestionar les compres que es fan.
Per poder gestionar les compres, instal¬∑larem el m√≤dul "Compra".

![alt text](./imatges/image-12.png)

Un cop instal¬∑lat tot correctament, tindrem al men√∫ "superior esquerre" una nova secci√≥ "Compra", amb subseccions com "Comandes", "Productes", "Informes" i "Configuraci√≥".

<div align="center">
  <img src="./imatges/image-13.png" alt="Texto alternativo">
</div>

Si visitem les diferents seccions, comprovarem que aquest m√≤dul est√† interconnectat als altres com "Facturaci√≥" (elements com ara clients, prove√Ødors i productes, s√≥n comuns). 
Aquest grau d'interconnexi√≥ de m√≤duls facilita que Odoo siga un sistema integral i evita redund√†ncia de dades, errors, etc.
Entre altres opcions, amb aquest m√≤dul podrem:
- Realitzar sol¬∑licituds de pressupostos de compra.
  - Aquests pressupostos es poden enviar per correu electr√≤nic o imprimir-se.
- Realitzar comandes o convertir en comanda un pressupost de compra.
A continuaci√≥ un pressupost de compra de "Duff 0.0":

![alt text](./imatges/image-14.png)

Un cop confirmat aquest pressupost, es converteix en comanda com veiem aqu√≠:

![alt text](./imatges/image-15.png)

# **6. M√≤dul "Vendes"**
Moe, content i extasiat per la comoditat que li ha proporcionat el m√≤dul "Compra", vol aplicar al que m√©s li importa a ell: les vendes. Instal¬∑larem el m√≤dul "Vendes".

![alt text](./imatges/image-16.png)

Un cop instal¬∑lat tot correctament, tindrem al men√∫ "superior esquerre" una nova secci√≥ "Vendes", amb subseccions com "Comandes", "A facturar", "Productes", "Informes" i "Configuraci√≥".

![alt text](./imatges/image-17.png)

Aqu√≠ un exemple on Barney Gumble ha demanat pressupost per pagar diverses rondes de cervesa Duff amb els amics.

![alt text](./imatges/image-18.png)

Una vegada confirmat el pressupost es genera la comanda i fins i tot aprofitant la interconnexi√≥ amb el m√≤dul de "Facturaci√≥", generar la factura de la comanda.
A continuaci√≥, podem veure la factura generada per Barney Gumble:

![alt text](./imatges/image-19.png)
       
# **7. M√≤dul "Punt de venda"**
Lurleen Lumpkin treballa molt de valent com a cambrera a la taverna de Moe, per√≤ √∫ltimament est√† molt esgotada, ja que compaginar la feina de cambrera amb ser cantant de m√∫sica country √©s molt sacrificat. Moe vol ajudar a Lurleen i per facilitar la presa de notes, l'ha dotat d'un dispositiu m√≤bil amb acc√©s a Odoo i ha instal¬∑lat el m√≤dul "Punt de venda".

![alt text](./imatges/image-20.png)

Un cop instal¬∑lat tot correctament, tindrem al men√∫ "superior esquerre" una nova secci√≥ "Punt de venda", amb subseccions com "Tauler", "Comandes", "Productes", "Informes" i "Configuraci√≥".

>‚ùï Atenci√≥: els productes utilitzats en el punt de venda, han de ser donats d'alta de nou dins d'aquest m√≤dul.

![alt text](./imatges/image-21.png)

Un cop configurat els productes, tindrem acc√©s per a accedir al nostre punt de venda. Cada vegada que acabem d'utilitzar el punt de venda, √©s recomanable tancar sessi√≥ perqu√® els canvis siguen efectius.

![alt text](./imatges/image-22.png)

Aix√≤ ens permetr√† des de qualsevol dispositiu prendre una nota r√†pida dels productes de forma similar a com es veu a la imatge:

![alt text](./imatges/image-23.png)

Despr√©s d'un pagament registrat, fins i tot ens permet emetre un rebut des del mateix punt de venda:

![alt text](./imatges/image-24.png)
       
# **8. Altres m√≤duls interessants d‚ÄôOdoo**
Despr√©s d'aquesta experi√®ncia, Moe ha quedat meravellat per Odoo i les seues possibilitats. Els m√≤duls comentats anteriorment han fet un pas m√©s enll√† al seu negoci. S'ha posat a pensar en ampliacions futures i ha pres nota d'alguns m√≤duls d‚ÄôOdoo que li han semblat interessants per explorar i utilitzar en futures ampliacions:
- Websites i comer√ß electr√≤nic
  - Comer√ß electr√≤nic: permet implementar una botiga virtual vinculada a Odoo.
  - Website Builder: permet crear un lloc web des del mateix sistema Odoo.
  - Esdeveniments: permet gestionar esdeveniments i vendre entrades.
  - M√®tode de pagament Paypal: introdueix el m√®tode de pagament per Paypal.
- Relaci√≥ amb els clients
  - CRM: "Customer Relationship Management", per a seguiment de clients potencials i oportunitats de negoci.
  - Cites: m√≤dul per programar i gestionar cites amb clients.
  - M√†rqueting per email/SMS: aquests s√≥n dos m√≤duls per a la gesti√≥ de campanyes de m√†rqueting per email/SMS.
  - Signar: m√≤dul per signar documents r√†pidament.
- Relaci√≥ amb els empleats:
  - Calendari: m√≤dul per programar i gestionar cites amb empleats.
  - Despeses: m√≤dul per gestionar i validar despeses dels empleats.
  - Planificaci√≥: permet gestionar l'horari dels empleats .
  - Projecte: permet gestionar l'organitzaci√≥ de projectes de l'negoci.
  - Codi de barres: permetre l'√∫s de codi de barres per a operacions log√≠stiques.
  - Manteniment: m√≤dul que permet gestionar necessitats de manteniment del negoci.
    
# **9. C√≤pia de seguretat en Odoo**
Despr√©s dels fets de l'episodi "Strong Arms of The Ma", on intenten conv√©ncer a Marge que deixe els esteroides, la taverna de Moe acaba totalment destrossada. Moe decideix cremar la taverna per poder comen√ßar de nou. Quan ja li ha calat foc a la barra, Carl li etziba estranyat: "Per√≤ Moe ... No hauries de contractar una asseguran√ßa abans?".

Despr√©s d'aquest incident, amb la taverna cremada i sense asseguran√ßa de cobrar... Moe est√† trist i desanimat. Just en aquest moment recorda que va seguir una pol√≠tica de seguretat correcta i t√© c√≤pia de seguretat emmagatzemada fora de la taverna de tot el seu sistema Odoo, per la qual cosa podr√† cobrar els deutes a Barney i a la resta de parroquians i amb aix√≤ comen√ßar de nou.

> üí¨ Interessant: encara s'escapa una mica del temari d'aquest m√≤dul, √©s interessant con√©ixer principis sobre com dissenyar una pol√≠tica de c√≤pies de seguretat. M√©s informaci√≥ a [https://www.incibe.es/sites/default/files/contenidos/guias/guia-copias-de-seguridad.pdf]

## 9.1  Quins elements ha de contenir una c√≤pia de seguretat/migraci√≥ d‚ÄôOdoo?
Per poder realitzar una c√≤pia de seguretat o migraci√≥ d'un sistema Odoo, s'ha de fer c√≤pia dels seg√ºents elements:
- Sistema base d‚ÄôOdoo.
- Contingut de la base de dades PostgreSQL.
- Fitxer configuraci√≥ d‚ÄôOdoo, normalment localitzat en "/etc/odoo/odoo.conf".
- Contingut de les carpetes (generalment en "/var/lib/Odoo")
  - "addons" en cas de tenir m√≤duls extres instal¬∑lats.
  - "Sessions", amb emmagatzematge de les sessions.
  - "Firestore", amb alguns fitxers emmagatzemats per Odoo.

Un cop conegut que hem de copiar, distingim el cas d'una c√≤pia de seguretat i d'una migraci√≥ de sistema (de servidor, amb la mateixa versi√≥ o entre versions):
- C√≤pia de seguretat: en aquest cas, simplement haur√≠em d‚Äôemmagatzemar aquests elements i restaurar aquells que s'hagen danyat.
- Migraci√≥ de servidor, mateixa versi√≥ d‚ÄôOdoo: si realitzem una migraci√≥ mantenint la versi√≥ d‚ÄôOdoo, per exemple, passant el nostre sistema d'un servidor a un altre, simplement haurem de restaurar els elements anteriors i actualitzar el fitxer de configuraci√≥ Odoo amb els par√†metres del nou servidor.
- Migraci√≥ entre versions d'Odoo: aquest cas √©s m√©s complicat, pot ocasionar problemes i fins i tot no sempre √©s possible. Cal tenir clar que versions d‚ÄôOdoo s√≥n les implicades i investigar sobre el proc√©s de migraci√≥ entre aquestes.
- Entre altres coses, algunes migracions d‚ÄôOdoo permeten convertir la base de dades seguint el que indica [https://upgrade.odoo.com/]

## 9.2  Fent c√≤pia de la base del sistema d'Odoo
Per aquest cas, la millor idea √©s fer c√≤pia de sistema Odoo ja siga descarregant la versi√≥ actual d‚ÄôOdoo en el moment de la instal¬∑laci√≥ des de [https://www.odoo.com/es_ES/page/download] o si vols utilitzar l'√∫ltima versi√≥ de la teua branca, pots obtenir-la des de les "Nighty builds" a [https://nightly.odoo.com/].

En el cas d'una instal¬∑laci√≥ usant Docker, la millor manera de preservar el sistema base √©s fent una c√≤pia de seguretat de la imatge d‚ÄôOdoo utilitzada per llan√ßar el sistema, generalment obtinguda de  [https://hub.docker.com/_/Odoo].

## 9.3  Fent c√≤pia de la base de dades PostgreSQL
Per fer una c√≤pia de seguretat de la base de dades de PostgreSQL, tenim dues vies:

**<u>Interf√≠cie d‚ÄôOdoo</u>**:
Utilitzar la interf√≠cie d‚ÄôOdoo accedint a [http://localhost:8069/web/database/manager] (canviant "localhost:8069" per la direcci√≥ del teu host d‚ÄôOdoo). En aquesta interf√≠cie, podr√†s tant fer c√≤pia de seguretat de la base de dades com restaurar-la. Per a l'acc√©s a aquesta eina, se't demanar√† el "password mestre" de la instal¬∑laci√≥ d‚ÄôOdoo.

**<u>C√≤pia de seguretat tradicional</u>**:
Fer una c√≤pia de seguretat cl√†ssica d'una base de dades PostgreSQL amb les eines que estimem convenients. Un exemple de passos per a aquesta c√≤pia serien:

> service postgresql stop
#per c√≤pia
pg_dump -U usariobd nombrebd > ficherocopia.sql 
#per restaurar
psql -U usariobd nombrebd < ficherocopia.sql 
service postgresql start

Despr√©s d'aix√≤, tindr√≠em la c√≤pia de seguretat en el fitxer "ficherocopia.sql".

En aquesta segona via, si estem utilitzant Docker Compose amb la configuraci√≥ proposada en la unitat 03, simplement n'hi hauria prou amb fer c√≤pia de la imatge Docker de la base de dades i de la carpeta que hem configurat perqu√® tinga persist√®ncia (carpeta "/var/lib/postgresql/ data "dins del contenidor, mapejada a "./volumesOdoo/dataPostgreSQL" fora d'ell). Exemple:
1. Exportar la imatge Docker de la base de dades: Suposant que la imatge es diu postgres, pots exportar-la amb:
> docker save -o postgres_backup.tar postgres

2. Fer c√≤pia de la carpeta de persist√®ncia: La carpeta mapejada √©s ./volumesOdoo/dataPostgreSQL, que correspon a /var/lib/postgresql/data dins del contenidor.:
> cp -r ./volumesOdoo/dataPostgreSQL ./backup/dataPostgreSQL_$(date +%Y%m%d)

3. Restauraci√≥ (si cal): Imatge Docker i Dades persistents
docker load -i postgres_backup.tar
> cp -r ./backup/dataPostgreSQL_YYYYMMDD ./volumesOdoo/dataPostgreSQL


Si, aix√≠ i tot, volem fer la c√≤pia de seguretat usant "pg_dump", podr√≠em accedir a l'interior del contenidor Docker amb l'ordre:
> docker compose exec db bash

Si a m√©s, volgu√©rem copiar fora del contenidor "ficherocopia.sql" haur√≠em de realitzar dos passos. En el primer, hem de con√©ixer el nom del contenidor de la base de dades, usant:
> docker compose ps

Una vegada conegut, des de l‚Äôamfitri√≥ podr√≠em fer servir una ordre semblant a:
> docker cp contenidor:/rutacontenedor/ficherocopia.sql /rutaanfitrion

## 9.4  Fent c√≤pia del fitxer de configuraci√≥ i carpetes necess√†ries
En aquest cas, simplement √©s fer una c√≤pia simple tant del fitxer de configuraci√≥ d‚ÄôOdoo, com de les carpetes indicades ( "addons", "sessions" i "firestore").
Si estem utilitzant Docker Compose amb la configuraci√≥ proposada en la unitat 02, les tres carpetes ("addons", "sessions" i "firestore") ja estan mapejades dins de "./volumesOdoo" i simplement haurem de fer c√≤pia de seguretat d'aquestes dades mapejats.
No obstant aix√≤, per copiar el fitxer de configuraci√≥, haur√≠em de seguir els seg√ºents passos. En el primer, hem de con√©ixer el nom del contenidor d‚Äô Odoo, usant:
> docker compose ps

Un cop conegut, des de l‚Äôamfitri√≥ podr√≠em fer servir una ordre semblant a:
> docker cp contenidor:/etc/odoo/odoo.conf /rutaanfitrion

# **10.  Bibliografia**
- Sistemes de Gesti√≥ Empresarial IOC: 
[https://ioc.xtec.cat/materials/FP/Materials/2252_DAM/DAM_2252_M10/web/html/index.html]
- Documentaci√≥ d‚ÄôOdoo:
[https://www.odoo.com/documentation/17.0/es/]
- Documentaci√≥ d'usuari de Odoo:
[https://www.odoo.com/documentation/user/14.0/es/]

       